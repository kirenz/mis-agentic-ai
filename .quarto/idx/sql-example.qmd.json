{"title":"SQL Example Script","markdown":{"yaml":{"title":"SQL Example Script"},"headingText":"What the script does","containsRefs":false,"markdown":"\n\nThis chapter walks through `sql_example.py`, a self-contained example that connects to SQL Server, runs a sample query, and prints the results with `pandas`. Use it as a template for your own analytics scripts once the database connection is working.\n\n\nThe script demonstrates an end-to-end query workflow:\n\n- loads the required libraries (`dotenv`, `sqlalchemy`, `pandas`) and environment variables\n- builds a secure connection string from the `.env` values\n- creates an engine with `SQLAlchemy` and verifies the database connection\n- runs a sample query and prints the first rows of a table\n\nAlways execute the script through your managed environment:\n\n```bash\nuv run python sql_example.py\n```\n\n`uv run` guarantees that the dependencies defined in `pyproject.toml` are loaded. Once the connection works, you can reuse the structure for your own queries.\n\n## Step by step\n\n### 1. Load libraries and parse the `.env`\n\n```python\nimport os\nimport urllib.parse\nimport pandas as pd\nfrom dotenv import load_dotenv\nfrom sqlalchemy import create_engine, text\n\nload_dotenv()\n```\n\n`load_dotenv()` reads the connection parameters from the `.env` file so credentials stay out of the source code. If any of the required values (server, database, username, password) are missing, the script aborts with a clear error message—double-check the `.env` file first.\n\n### 2. Prepare connection parameters\n\n```python\nSERVER = os.getenv(\"MSSQL_SERVER\")\nDATABASE = os.getenv(\"MSSQL_DATABASE\")\nUSERNAME = os.getenv(\"MSSQL_USERNAME\")\nPASSWORD = os.getenv(\"MSSQL_PASSWORD\")\nDRIVER = os.getenv(\"MSSQL_DRIVER\", \"ODBC Driver 18 for SQL Server\")\nTRUST_CERT = os.getenv(\"TRUST_SERVER_CERTIFICATE\", \"false\").lower() == \"true\"\n\nparams = urllib.parse.quote_plus(\n    f\"DRIVER={{{DRIVER}}};\"\n    f\"SERVER={SERVER};\"\n    f\"DATABASE={DATABASE};\"\n    f\"UID={USERNAME};\"\n    f\"PWD={PASSWORD};\"\n    f\"TrustServerCertificate={'Yes' if TRUST_CERT else 'No'};\"\n)\n```\n\n- `urllib.parse.quote_plus` escapes special characters in the password so the ODBC driver accepts the connection string.\n- The `TrustServerCertificate` flag is controlled via the `.env` variable `TRUST_SERVER_CERTIFICATE` and defaults to off.\n\n### 3. Create the engine and test the connection\n\n```python\nengine = create_engine(f\"mssql+pyodbc:///?odbc_connect={params}\")\n\nwith engine.connect() as connection:\n    version = connection.execute(text(\"SELECT @@VERSION AS version\"))\n    print(\"Connection successful!\")\n    print(\"SQL Server version:\", version.scalar())\n```\n\nThe engine manages the connection pool. The `with` block ensures the session closes properly after the query. The initial `SELECT @@VERSION` confirms that connectivity works and prints the SQL Server version that responded.\n\n### 4. Sample query with `pandas`\n\n```python\nSAMPLE_QUERY = text(\n    \"\"\"\n    SELECT TOP (10)\n           ID_Product,\n           Material_Description,\n           Product_Category,\n           Transfer_Price_EUR\n    FROM dbo.Dim_Product\n    ORDER BY ID_Product;\n    \"\"\"\n)\n\ndf = pd.read_sql(SAMPLE_QUERY, connection)\nprint(\"\\nSample data:\")\nprint(df)\n```\n\n`pd.read_sql` combines SQLAlchemy and `pandas` so you get a DataFrame directly. The call runs inside the same `with` block as the version query, meaning the connection closes automatically. Modify the SQL statement to match tables you can access. The goal is to see the data quickly without exporting to CSV first.\n\n## Adapt it to your projects\n\n- **Explore new tables:** Adjust the selected columns and the `FROM` clause to inspect other datasets.\n- **Add additional checks:** Chain multiple `text()` statements to run sanity checks in sequence.\n- **Persist results:** Append `df.to_csv(...)` or `df.to_parquet(...)` if you want to store query outputs for later.\n\nKeep the structure modular: one function that returns the engine, another for common queries, and dedicated modules for heavier analytics. That approach keeps the code testable and reusable in notebooks, ETL jobs, or dashboards.\n","srcMarkdownNoYaml":"\n\nThis chapter walks through `sql_example.py`, a self-contained example that connects to SQL Server, runs a sample query, and prints the results with `pandas`. Use it as a template for your own analytics scripts once the database connection is working.\n\n## What the script does\n\nThe script demonstrates an end-to-end query workflow:\n\n- loads the required libraries (`dotenv`, `sqlalchemy`, `pandas`) and environment variables\n- builds a secure connection string from the `.env` values\n- creates an engine with `SQLAlchemy` and verifies the database connection\n- runs a sample query and prints the first rows of a table\n\nAlways execute the script through your managed environment:\n\n```bash\nuv run python sql_example.py\n```\n\n`uv run` guarantees that the dependencies defined in `pyproject.toml` are loaded. Once the connection works, you can reuse the structure for your own queries.\n\n## Step by step\n\n### 1. Load libraries and parse the `.env`\n\n```python\nimport os\nimport urllib.parse\nimport pandas as pd\nfrom dotenv import load_dotenv\nfrom sqlalchemy import create_engine, text\n\nload_dotenv()\n```\n\n`load_dotenv()` reads the connection parameters from the `.env` file so credentials stay out of the source code. If any of the required values (server, database, username, password) are missing, the script aborts with a clear error message—double-check the `.env` file first.\n\n### 2. Prepare connection parameters\n\n```python\nSERVER = os.getenv(\"MSSQL_SERVER\")\nDATABASE = os.getenv(\"MSSQL_DATABASE\")\nUSERNAME = os.getenv(\"MSSQL_USERNAME\")\nPASSWORD = os.getenv(\"MSSQL_PASSWORD\")\nDRIVER = os.getenv(\"MSSQL_DRIVER\", \"ODBC Driver 18 for SQL Server\")\nTRUST_CERT = os.getenv(\"TRUST_SERVER_CERTIFICATE\", \"false\").lower() == \"true\"\n\nparams = urllib.parse.quote_plus(\n    f\"DRIVER={{{DRIVER}}};\"\n    f\"SERVER={SERVER};\"\n    f\"DATABASE={DATABASE};\"\n    f\"UID={USERNAME};\"\n    f\"PWD={PASSWORD};\"\n    f\"TrustServerCertificate={'Yes' if TRUST_CERT else 'No'};\"\n)\n```\n\n- `urllib.parse.quote_plus` escapes special characters in the password so the ODBC driver accepts the connection string.\n- The `TrustServerCertificate` flag is controlled via the `.env` variable `TRUST_SERVER_CERTIFICATE` and defaults to off.\n\n### 3. Create the engine and test the connection\n\n```python\nengine = create_engine(f\"mssql+pyodbc:///?odbc_connect={params}\")\n\nwith engine.connect() as connection:\n    version = connection.execute(text(\"SELECT @@VERSION AS version\"))\n    print(\"Connection successful!\")\n    print(\"SQL Server version:\", version.scalar())\n```\n\nThe engine manages the connection pool. The `with` block ensures the session closes properly after the query. The initial `SELECT @@VERSION` confirms that connectivity works and prints the SQL Server version that responded.\n\n### 4. Sample query with `pandas`\n\n```python\nSAMPLE_QUERY = text(\n    \"\"\"\n    SELECT TOP (10)\n           ID_Product,\n           Material_Description,\n           Product_Category,\n           Transfer_Price_EUR\n    FROM dbo.Dim_Product\n    ORDER BY ID_Product;\n    \"\"\"\n)\n\ndf = pd.read_sql(SAMPLE_QUERY, connection)\nprint(\"\\nSample data:\")\nprint(df)\n```\n\n`pd.read_sql` combines SQLAlchemy and `pandas` so you get a DataFrame directly. The call runs inside the same `with` block as the version query, meaning the connection closes automatically. Modify the SQL statement to match tables you can access. The goal is to see the data quickly without exporting to CSV first.\n\n## Adapt it to your projects\n\n- **Explore new tables:** Adjust the selected columns and the `FROM` clause to inspect other datasets.\n- **Add additional checks:** Chain multiple `text()` statements to run sanity checks in sequence.\n- **Persist results:** Append `df.to_csv(...)` or `df.to_parquet(...)` if you want to store query outputs for later.\n\nKeep the structure modular: one function that returns the engine, another for common queries, and dedicated modules for heavier analytics. That approach keeps the code testable and reusable in notebooks, ETL jobs, or dashboards.\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","number-sections":true,"toc":true,"css":["theme.scss"],"highlight-style":"github","include-in-header":{"text":"<style>\n.cmd-explain {\n  font-weight: 600;\n  margin-top: 1rem;\n}\n</style>\n"},"output-file":"sql-example.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.7.31","theme":"cosmo","code-copy":true,"author-meta":"Jan Kirenz","callout-appearance":"simple","title":"SQL Example Script"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}